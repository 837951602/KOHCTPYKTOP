<!DOCTYPE html><script src="pako.min.js" origsrc="https://cdn.jsdelivr.net/npm/pako@2.1.0/dist/pako.min.js"></script><body oncontextmenu="return false" onselectionstart="return false"><center><div id="gameDiv" style="overflow:hidden; zoom:2;"><canvas id="gameSel" style="position: absolute; display: none; border: white 1px solid; z-index:9"onmousemove="SelEvent(event.offsetX + 2*parseFloat(this.style.marginLeft),event.offsetY + 2*parseFloat(this.style.marginTop),2,event)" onmousedown="SelEvent(event.offsetX + 2*parseFloat(this.style.marginLeft),event.offsetY + 2*parseFloat(this.style.marginTop),1,event)" onmouseup="SelEvent(event.offsetX + 2*parseFloat(this.style.marginLeft),event.offsetY + 2*parseFloat(this.style.marginTop),3,event)"></canvas><canvas id="gameCanvas" style="background-image: url('data:image/png;base64,Qk32AAAAAAAAADYAAAAoAAAACAAAAAgAAAABABgAAAAAAMAAAAAAAAAAAAAAAAAAAAAAAAAAgICAgICAgICAgICAgICAgICAgICAgICAwMDAwMDAwMDAwMDAwMDAwMDAwMDAgICAwMDAwMDAwMDAwMDAwMDAwMDAwMDAgICAwMDAwMDAwMDAwMDAwMDAwMDAwMDAgICAwMDAwMDAwMDAwMDAwMDAwMDAwMDAgICAwMDAwMDAwMDAwMDAwMDAwMDAwMDAgICAwMDAwMDAwMDAwMDAwMDAwMDAwMDAgICAwMDAwMDAwMDAwMDAwMDAwMDAwMDAgICA')" onmousemove="CanvasEvent(event)" onmousedown="CanvasEvent(event)" onmouseup="SelEvent(event.offsetX,event.offsetY,3,event)"></canvas></div><input type="button" id="btnDesc" onclick="" value="Desc"><input type="hidden" id="btnVerify" onclick="" value="Verify"><input type="button" id="btnSelect" onclick="btnSelect.value = btnSelect.value == 'Selecting' ?(gameSel.style.display='none','Drawing') :'Selecting'" value="Drawing"><input type="button" id="btnRun" onclick="" value="Run"><input type="hidden" id="btnPause" onclick="" value="Pause"><input type="button" id="btnStep" onclick="" value="Step"><input type="button" onclick="fnDetach()" value="Detach"><input type="button" onclick="fnImport()" value="Import"><input type="button" onclick="fnExport()" value="Export"></center><script>const canvas = document.getElementById('gameCanvas');var SiMap, MeMap, ViaMap, SiSta, MeSta;var Width, Height, ctx, imgd;function EmptyArray(w, h) {const t = Array(2*w).fill(0).map(_=>Array(2*h).fill(0));t[-1] = t[-2] = t[-3] = t[-4] = 0;t[2*w] = t[2*w+1] = t[2*w+2] = 0;return t;}function InitMap(w, h) {Width = w;Height = h;canvas.width = w * 8;canvas.height = h * 8;gameDiv.style.width = w * 8 + 'px';gameDiv.style.height = h * 8 + 'px';ctx = canvas.getContext('2d');imgd = ctx.createImageData(w * 8, h * 8);imgdz = new Uint32Array(imgd.data.buffer);SiMap = EmptyArray(w, h);MeMap = EmptyArray(w, h);ViaMap = EmptyArray(w, h);SiSta = EmptyArray(w, h);MeSta = EmptyArray(w, h);}InitMap(100, 100);var moving = 0; var mvX1, mvX2, mvY1, mvY2;function SelEvent(x, y, t, e) {if (btnSelect.value != 'Selecting') return;switch (t) {case 1:if (mvX1 > mvX2) [mvX1, mvX2] = [mvX2, mvX1];if (mvY1 > mvY2) [mvY1, mvY2] = [mvY2, mvY1];moving = [e.ctrlKey ? 2 : 1, e.offsetX, e.offsetY, x, y];const qq = [mvX1 * 8 - 1,mvY1 * 8 - 1,(mvX2 - mvX1) * 8 + 8 +1,(mvY2 - mvY1) * 8 +8 +1];gameSel.getContext('2d').drawImage(canvas, ...qq, -1, -1, qq[2], qq[3]);if (moving[0] == 1) ctx.clearRect(...qq);break;case 2:if (moving && e.buttons == 0) SelEvent(x, y, 3, e);if (moving == 0 && e.buttons == 1) {mvX2 = x / 16 | 0;mvY2 = y / 16 | 0;gameSelBorder();} else if (moving) {gameSel.style.marginLeft = (x - moving[1]) / 2 + 'px';gameSel.style.marginTop = (y - moving[2]) / 2 + 'px';}break;case 3:var dx = Math.round((x - moving[3])/16)*2;var dy = Math.round((y - moving[4])/16)*2;if (mvX1 + dx >=0 && mvX2 + dx < Width &&mvY1 + dy >= 0 && mvY2 + dy < Height) {const A =[];for (var i=2*mvX1; i<=2*mvX2; ++i) {for (var j=2*mvY1; j<=2*mvY2; ++j) {A.push(SiMap[i][j]);A.push(MeMap[i][j]);A.push(ViaMap[i][j]);}}if (moving[0] == 1) {for (var i=2*mvX1; i<=2*mvX2; ++i) {for (var j=2*mvY1; j<=2*mvY2; ++j) {SiMap[i][j] = 0;MeMap[i][j] = 0;ViaMap[i][j] = 0;}}}for (var i=2*mvX2; i>=2*mvX1; --i) {for (var j=2*mvY2; j>=2*mvY1; --j) {ViaMap[i+dx][j+dy] = A.pop() || ViaMap[i+dx][j+dy];MeMap[i+dx][j+dy] = A.pop() || MeMap[i+dx][j+dy];SiMap[i+dx][j+dy] = A.pop() || SiMap[i+dx][j+dy];}}if (moving[0] == 1) {for (var i=mvX1; i<=mvX2; ++i) {CollapseSi(i<<1, mvY1<<1);CollapseSi(i<<1, mvY2<<1);if(MeMap[2*i][2*mvY1]==0)RemoveMe(i<<1,mvY1<<1);if(MeMap[2*i][2*mvY2]==0)RemoveMe(i<<1,mvY2<<1);}for (var i=mvY1; i<=mvY2; ++i) {CollapseSi( mvX1<<1,i<<1);CollapseSi( mvX2<<1,i<<1);if(MeMap[2*mvX1][2*i]==0)RemoveMe(mvX1<<1,i<<1);if(MeMap[2*mvX2][2*i]==0)RemoveMe(mvX2<<1,i<<1);}} dx/=2;dy/=2;for (var i=mvX1-1; i<=mvX2+1; ++i) {for (var j=mvY1-1; j<=mvY2+1; ++j) {CollapseSi( i+dx<<1,j+dy<<1);if(MeMap[2*i+dx+dx][2*j+dy+dy]==0)RemoveMe(i+dx<<1,j+dy<<1);}}mvX1+=dx;mvX2+=dx;mvY1+=dy;mvY2+=dy;}Refresh();gameSelBorder();moving = 0;}}var LastCanvasX, LastCanvasY, LastCanvasB;function gameSelBorder() {if (mvX1 < 0) mvX1 = 0; if (mvX1 >= Width) mvX1 = Width-1;if (mvX2 < 0) mvX2 = 0; if (mvX2 >= Width) mvX2 = Width-1;if (mvY1 < 0) mvY1 = 0; if (mvY1 >= Height) mvY1 = Height-1;if (mvY2 < 0) mvY2 = 0; if (mvY2 >= Height) mvY2 = Height-1;gameSel.style.marginLeft = Math.min(mvX1, mvX2) * 8 - 1 + 'px';gameSel.style.marginTop = Math.min(mvY1, mvY2) * 8 - 1 + 'px';gameSel.width = Math.abs(mvX1 - mvX2) * 8 + 8 - 1;gameSel.height = Math.abs(mvY1 - mvY2) * 8 +8 - 1;gameSel.style.display = 'block';}function CanvasEvent(e) {if (btnSelect.value == 'Drawing') {if (e.buttons != 1 && e.buttons != 2) return LastCanvasB = 0;if (LastCanvasB == 0) { LastCanvasX = e.offsetX; LastCanvasY = e.offsetY; }const bb = e.buttons + (e.shiftKey | e.altKey) * 2 + e.ctrlKey * 4;if (bb == 4 && e.type == 'mousedown') ViaMap[e.offsetX/16<<1][e.offsetY/16<<1] ^= 1;else CanvasConnect(LastCanvasX, LastCanvasY, e.offsetX, e.offsetY, bb);LastCanvasB = e.buttons; { LastCanvasX = e.offsetX; LastCanvasY = e.offsetY; }Refresh();} else if (btnSelect.value == 'Selecting') {if (e.type == 'mousedown' && e.button == 0) {mvX1 = mvX2 = e.offsetX / 16 | 0;mvY1 = mvY2 = e.offsetY / 16 | 0;gameSelBorder();} else if (e.type == 'mousemove') {SelEvent(e.offsetX,e.offsetY,2,e);}}}function CanvasConnect(x1, y1, x2, y2, e) {var X1 = x1 / 16 | 0;var Y1 = y1 / 16 | 0;var X2 = x2 / 16 | 0;var Y2 = y2 / 16 | 0;var dx = (X1-X2), dy = (Y1-Y2);switch (dx*dx + dy*dy) {case 0:case 1:break;case 2:var xmi = (X1 + X2 + 1) / 2 * 16;var ymi = (Y1 + Y2 + 1) / 2 * 16;var ymx = y1 + (y2 - y1) / (x2 - x1) * (xmi - x1);if (ymx > ymi ^ y1 > y2) {CanvasConnect(x1, y1, x1, y2, e);CanvasConnect(x1, y2, x2, y2, e);return;} else {CanvasConnect(x1, y1, x2, y1, e);CanvasConnect(x2, y1, x2, y2, e);return;}default:CanvasConnect(x1, y1, (x1 + x2) / 2, (y1 + y2) / 2, e);CanvasConnect((x1 + x2) / 2, (y1 + y2) / 2, x2, y2, e);return;}switch (e) {case 1:if (SiMap[X2*2][Y2*2] == 0) SiMap[X2*2][Y2*2] = 1;if (SiMap[X1*2][Y1*2] == 1 && SiMap[X2*2][Y2*2] == 1) SiMap[X1+X2][Y1+Y2] = 1;if (SiMap[X1*2][Y1*2] == 1 && (SiMap[X2*2][Y2*2]&3) == 2) {if (SiMap[X2*2+dy][Y2*2+dx] == 2 &&SiMap[X2*2-dy][Y2*2-dx] == 2 &&SiMap[X2*2+dx][Y2*2+dy] == 0 &&SiMap[X2*2-dx][Y2*2-dy] != 2) {SiMap[X1+X2][Y1+Y2] = 1;SiMap[X2*2][Y2*2] = dx ? 6 : 10;ViaMap[X2*2][Y2*2] = 0;}}break;case 2:if (SiMap[X2*2][Y2*2] == 0) SiMap[X2*2][Y2*2] = 2;if (SiMap[X1*2][Y1*2] == 2 && SiMap[X2*2][Y2*2] == 2) SiMap[X1+X2][Y1+Y2] = 2;if (SiMap[X1*2][Y1*2] == 2 && (SiMap[X2*2][Y2*2]&3) == 1) {if (SiMap[X2*2+dy][Y2*2+dx] == 1 &&SiMap[X2*2-dy][Y2*2-dx] == 1 &&SiMap[X2*2+dx][Y2*2+dy] == 0 &&SiMap[X2*2-dx][Y2*2-dy] != 1) {SiMap[X1+X2][Y1+Y2] = 2;SiMap[X2*2][Y2*2] = dx ? 5 : 9;ViaMap[X2*2][Y2*2] = 0;}}break;case 3:if (MeMap[X2*2][Y2*2] == 0) MeMap[X2*2][Y2*2] = 1;if (MeMap[X1*2][Y1*2] == 1 && MeMap[X2*2][Y2*2] == 1) MeMap[X1+X2][Y1+Y2] = 1;break;case 4:if (SiMap[X1*2][Y1*2] == 1 || SiMap[X1*2][Y1*2] == 2) ViaMap[X1*2][Y1*2] = 1;if (SiMap[X2*2][Y2*2] == 1 || SiMap[X2*2][Y2*2] == 2) ViaMap[X2*2][Y2*2] = 1;break;case 5:SiMap[X2*2][Y2*2] = 0;CollapseSi(X2*2, Y2*2);break;case 6:RemoveMe(X2*2, Y2*2);break;}}function RemoveMe(x, y) {for (var [dx,dy] of [[-1,0],[1,0],[0,1],[0,-1],[0,0]])MeMap[x+dx][y+dy] = 0;}function CollapseSi(x, y) {const c = SiMap[x][y] & 3, b = 3 ^ c;switch (SiMap[x][y]) {case 0: case undefined:ViaMap[x][y] = 0;for (var [dx,dy] of [[-1,0],[1,0],[0,1],[0,-1]]) {if (SiMap[x+dx][y+dy]) {SiMap[x+dx][y+dy] = 0;CollapseSi(x+2*dx,y+2*dy);}}break;case 1: case 2:for (var [dx,dy] of [[-1,0],[1,0],[0,1],[0,-1]]) {if (SiMap[x+dx][y+dy] == b) {SiMap[x+dx][y+dy] = 0;CollapseSi(x+2*dx,y+2*dy);}}break;case 5: case 6:ViaMap[x][y] = 0;for (var i of [-1,1]) {if (SiMap[x][y+i] == b) {SiMap[x][y+i] = 0;CollapseSi(x,y+2*i);} else if (SiMap[x][y+i] == 0) {SiMap[x][y] = c;return CollapseSi(x,y);}if (SiMap[x+i][y] == c) {SiMap[x+i][y] = 0;CollapseSi(x+2*i,y);}}if (SiMap[x+1][y]==0 && SiMap[x-1][y]==0) {SiMap[x][y] = c;return CollapseSi(x,y);}break;case 9: case 10:ViaMap[x][y] = 0;for (var i of [-1,1]) {if (SiMap[x+i][y] == b) {SiMap[x+i][y] = 0;CollapseSi(x+2*i,y);} else if (SiMap[x+i][y] == 0) {SiMap[x][y] = c;return CollapseSi(x,y);}if (SiMap[x][y+i] == c) {SiMap[x][y+i] = 0;CollapseSi(x,y+2*i);}}if (SiMap[x][y+1]==0 && SiMap[x][y-1]==0) {SiMap[x][y] = c;return CollapseSi(x,y);}break;}}var Sprite32;function Refresh() {requestAnimationFrame(Refresh2);}function Refresh2() {var T1 = performance.now();function NB(M, x, y, k, b) {return [(3 - !!M[x-1][y] - 2*!!M[x][y-1] || (M[x-2][y-1] && M[x-1][y-2] ? 4 : 0)) *k+b,(3 - !!M[x+1][y] - 2*!!M[x][y-1] || (M[x+2][y-1] && M[x+1][y-2] ? 4 : 0)) *k+b,(3 - !!M[x-1][y] - 2*!!M[x][y+1] || (M[x-2][y+1] && M[x-1][y+2] ? 4 : 0)) *k+b,(3 - !!M[x+1][y] - 2*!!M[x][y+1] || (M[x+2][y+1] && M[x+1][y+2] ? 4 : 0)) *k+b,];}function NG(M, N, x, y, b, p, q) {return [p*!!N[x-1][y] +q*!!M[x][y-1] +b,p*!!N[x+1][y] +q*!!M[x][y-1] +b,p*!!N[x-1][y] +q*!!M[x][y+1] +b,p*!!N[x+1][y] +q*!!M[x][y+1] +b,];}for (var x = 0; x < Width; ++x) {for (var y = 0; y < Height; ++y) {var fx, fy;switch (SiMap[2*x][2*y]) {case 0: fx = [72, 72, 72, 72]; break;case 1: fx = NB(SiMap, 2*x, 2*y, 16, 0+ViaMap[2*x][2*y]*2); break;case 2: fx = NB(SiMap, 2*x, 2*y, 16, 4+ViaMap[2*x][2*y]*2); break;case 6: fx = NG(SiSta, SiMap, 2*x, 2*y, 40, 16, 2); break;case 10: fx = NG(SiMap, SiSta, 2*x, 2*y, 8, 2, 16); break;case 5: fx = NG(SiSta, SiMap, 2*x, 2*y, 44, 16, 2); break;case 9: fx = NG(SiMap, SiSta, 2*x, 2*y, 12, 2, 16); break;}switch (MeMap[2*x][2*y]) {case 0: fy = [10, 10, 10, 10]; break;case 1: fy = NB(MeMap, 2*x, 2*y, 2, 0); break;}const w = Width * 8;for (var i=0; i<4; ++i) fx[i] *= 8, fy[i] *= 8;for (var i=0; i<4; ++i) for (var j=0; j<4; ++j) {imgdz[(8*y+i)*w+8*x+j] = Sprite32[(fy[0]+i)*584+(fx[0]+j)];imgdz[(8*y+i)*w+8*x+j+4] = Sprite32[(fy[1]+i)*584+(fx[1]+j+4)];imgdz[(8*y+i+4)*w+8*x+j] = Sprite32[(fy[2]+i+4)*584+(fx[2]+j)];imgdz[(8*y+i+4)*w+8*x+j+4] = Sprite32[(fy[3]+i+4)*584+(fx[3]+j+4)];}}}ctx.putImageData(imgd,0,0) ;console.log('Refresh time', performance.now() - T1);}(i=>{i.onload=j=>{j = new OffscreenCanvas(584, 88).getContext('2d');j.drawImage(i,0,0);Sprite32 = new Uint32Array(j.getImageData(0,0,584,88).data.buffer);Sprite32.ex = i;Refresh();};i.crossOrigin = "anonymous";i.src ="data:image/png;base64,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";})(new Image());console.log(8);function readAMF(x) {if (!x.rdPos) x.rdPos = 0;const rd = ()=> x[x.rdPos++];const rdInt = (i=4,a=0,b=rd())=>--i?b&128?rdInt(i,a*128+b-128):a*128+b:a*256+b;switch (rd()) {case 2: return 0;case 3: return 1;case 4: return rdInt();case 9:const lenp = rdInt();if (!(lenp & 1)) throw "Unsupported: 9/even" + lenp;if (rd() != 1) throw "Unsupported: 9/-/" + x[x.rdPos-1];return [...Array(lenp>>1)].map(_=>readAMF(x));default:throw "Unsupported: " + x[x.rdPos-1];}}function writeAMF(x, buf) {const wrInt = (n,f=0)=>{if (n < 0 || n >= 2**29 || n%1) throw "Invalid number:" + n;if (n >= 0x200000) wrInt(n>>8, 128), buf.push(n&255); else if (n >= 128) wrInt(n>>7, 128), buf.push(n&127 | f); else buf.push(n | f);};if (x == 0) { buf.push(2); return }if (x == 1) { buf.push(3); return }if (typeof x == 'number') { buf.push(4); wrInt(x); return; }if (x instanceof Array) {buf.push(9); wrInt(x.length * 2 + 1); buf.push(1); x.map(t=>writeAMF(t, buf)); return; }throw "Unsupported Object";}function base64ToUint8Array(b64) {const binary = atob(b64);const len = binary.length;const bytes = new Uint8Array(len);for (let i = 0; i < len; i++) {bytes[i] = binary.charCodeAt(i);}return bytes;}function uint8ArrayToBase64(x) {return btoa(String.fromCharCode(...x));}function fnImport() {try {var s = prompt('Input save');var x = pako.inflate(base64ToUint8Array(s));if (readAMF(x) !== 0x2c || readAMF(x) !== 0x1b) throw "Bad header";const Si = readAMF(x);const Me = readAMF(x);const Vc = readAMF(x);const Hc = readAMF(x);const Via = readAMF(x);const SiR = readAMF(x);const SiD = readAMF(x);const MeR = readAMF(x);const MeD = readAMF(x);var written = 1;InitMap(Si.length, Si[0].length);for (var x = 0; x < Si.length; ++x) {for (var y = 0; y < Si[0].length; ++y) {SiMap[2*x][2*y] = Si[x][y];SiMap[2*x+1][2*y] = SiR[x][y] && Si[x][y] ^ (Hc[x][y] && 3);SiMap[2*x][2*y+1] = SiD[x][y] && Si[x][y] ^ (Vc[x][y] && 3);if (Hc[x][y]) SiMap[2*x][2*y] += 4;if (Vc[x][y]) SiMap[2*x][2*y] += 8;MeMap[2*x][2*y] = Me[x][y];MeMap[2*x+1][2*y] = MeR[x][y];MeMap[2*x][2*y+1] = MeD[x][y];ViaMap[2*x][2*y] = Via[x][y];}}Refresh();} catch(e) {if (written) InitMap(44, 27);console.error(e)}}function fnExport() {try {const buf = [4, 0x2c, 4, 0x1b];SiMap.forEach(c=>{while(c.length>Height*2)c.pop()});writeAMF(SiMap.filter((_,i)=>i<Width*2&&i%2==0).map(r=>r.filter((_,i)=>i%2==0).map(c=>c&3)),buf);writeAMF(MeMap.filter((_,i)=>i<Width*2&&i%2==0).map(r=>r.filter((_,i)=>i%2==0).map(c=>c&3)),buf);writeAMF(SiMap.filter((_,i)=>i<Width*2&&i%2==0).map(r=>r.filter((_,i)=>i%2==0).map(c=>c&8?1:0)),buf);writeAMF(SiMap.filter((_,i)=>i<Width*2&&i%2==0).map(r=>r.filter((_,i)=>i%2==0).map(c=>c&4?1:0)),buf);writeAMF(ViaMap.filter((_,i)=>i<Width*2&&i%2==0).map(r=>r.filter((_,i)=>i%2==0)),buf);writeAMF(SiMap.filter((_,i)=>i<Width*2&&i%2==1).map(r=>r.filter((_,i)=>i%2==0).map(c=>c&3)),buf);writeAMF(SiMap.filter((_,i)=>i<Width*2&&i%2==0).map(r=>r.filter((_,i)=>i%2==1).map(c=>c&3)),buf);writeAMF(MeMap.filter((_,i)=>i<Width*2&&i%2==1).map(r=>r.filter((_,i)=>i%2==0).map(c=>c&3)),buf);writeAMF(MeMap.filter((_,i)=>i<Width*2&&i%2==0).map(r=>r.filter((_,i)=>i%2==1).map(c=>c&3)),buf);prompt("Copy following code", uint8ArrayToBase64(pako.deflate(new Uint8Array(buf))));} catch(e) {console.error(e)}}</script>
